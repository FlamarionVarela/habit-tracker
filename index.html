<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📊 Rastreador de Hábitos</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="Rastreador de hábitos circular com backup Google Drive">
    <meta name="theme-color" content="#1F2937">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📊</text></svg>">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React 18 Development (para melhor debugging) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Google APIs -->
    <script src="https://apis.google.com/js/api.js"></script>
    
    <style>
        body {
            overscroll-behavior: none;
            -webkit-overflow-scrolling: touch;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #111827;
            color: white;
        }
        
        .loaded .loading {
            display: none;
        }
        
        @media (max-width: 768px) {
            button {
                min-height: 44px;
                min-width: 44px;
            }
        }
    </style>
</head>
<body class="bg-gray-900">
    <!-- Loading Screen -->
    <div class="loading">
        <div class="text-center">
            <div class="text-4xl mb-4">📊</div>
            <div class="text-xl">Carregando Rastreador de Hábitos...</div>
        </div>
    </div>
    
    <!-- React App Container -->
    <div id="root"></div>

    <!-- React Component Script -->
    <script type="text/babel">
        // Verificar dependências
        console.log('🔍 Verificando dependências...');
        console.log('React:', typeof React !== 'undefined' ? '✅' : '❌');
        console.log('ReactDOM:', typeof ReactDOM !== 'undefined' ? '✅' : '❌');
        console.log('Lucide:', typeof lucide !== 'undefined' ? '✅' : '❌');

        if (typeof React === 'undefined') {
            throw new Error('React não carregou');
        }
        if (typeof ReactDOM === 'undefined') {
            throw new Error('ReactDOM não carregou');
        }
        if (typeof lucide === 'undefined') {
            throw new Error('Lucide não carregou');
        }

        const { useState, useEffect, useCallback, useRef } = React;
        
        // Extrair ícones de forma segura
        const SafeIcon = ({ iconName, className = "w-4 h-4", ...props }) => {
            try {
                const IconComponent = lucide[iconName];
                if (!IconComponent) {
                    console.warn(`Ícone ${iconName} não encontrado`);
                    return React.createElement('span', { className }, '🔲');
                }
                return React.createElement(IconComponent, { className, ...props });
            } catch (error) {
                console.warn(`Erro ao renderizar ícone ${iconName}:`, error);
                return React.createElement('span', { className }, '🔲');
            }
        };

        // Componente principal simplificado
        const HabitTracker = () => {
            const [isInitialized, setIsInitialized] = useState(false);
            const [currentMonth, setCurrentMonth] = useState(new Date().getMonth());
            const [currentYear, setCurrentYear] = useState(new Date().getFullYear());
            const [habits, setHabits] = useState({});
            const [habitData, setHabitData] = useState({});
            const [showAddForm, setShowAddForm] = useState(false);
            const [newHabitName, setNewHabitName] = useState('');
            const [saveStatus, setSaveStatus] = useState('saved');

            // Funções de persistência
            const saveToLocalStorage = useCallback((key, data) => {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error('Erro ao salvar:', error);
                    return false;
                }
            }, []);

            const loadFromLocalStorage = useCallback((key) => {
                try {
                    const item = localStorage.getItem(key);
                    return item ? JSON.parse(item) : null;
                } catch (error) {
                    console.error('Erro ao carregar:', error);
                    return null;
                }
            }, []);

            // Auto-save
            const autoSave = useCallback(() => {
                setSaveStatus('saving');
                const success = saveToLocalStorage('habitTracker_data', {
                    habits,
                    habitData,
                    currentMonth,
                    currentYear,
                    timestamp: Date.now()
                });
                setSaveStatus(success ? 'saved' : 'error');
            }, [habits, habitData, currentMonth, currentYear, saveToLocalStorage]);

            // Carregar dados na inicialização
            useEffect(() => {
                console.log('🚀 Inicializando aplicação...');
                
                try {
                    const savedData = loadFromLocalStorage('habitTracker_data');
                    if (savedData) {
                        console.log('📁 Dados encontrados, carregando...');
                        if (savedData.habits) setHabits(savedData.habits);
                        if (savedData.habitData) setHabitData(savedData.habitData);
                        if (savedData.currentMonth !== undefined) setCurrentMonth(savedData.currentMonth);
                        if (savedData.currentYear !== undefined) setCurrentYear(savedData.currentYear);
                    } else {
                        console.log('📝 Primeiro acesso, dados vazios');
                    }
                } catch (error) {
                    console.error('❌ Erro ao carregar dados:', error);
                }

                setIsInitialized(true);
                document.body.classList.add('loaded');
            }, [loadFromLocalStorage]);

            // Auto-save quando dados mudam
            useEffect(() => {
                if (isInitialized) {
                    const timeoutId = setTimeout(autoSave, 1000);
                    return () => clearTimeout(timeoutId);
                }
            }, [habits, habitData, isInitialized, autoSave]);

            // Criar hábitos de exemplo
            const createExampleHabits = () => {
                const monthKey = `${currentYear}-${currentMonth}`;
                const exampleHabits = {
                    [monthKey]: [
                        {
                            id: Date.now() + 1,
                            name: "Água 2L 💧",
                            priority: "high",
                            daysType: "all"
                        },
                        {
                            id: Date.now() + 2,
                            name: "Exercício 🏃‍♂️",
                            priority: "medium",
                            daysType: "weekdays"
                        },
                        {
                            id: Date.now() + 3,
                            name: "Leitura 📚",
                            priority: "low",
                            daysType: "all"
                        }
                    ]
                };
                setHabits(exampleHabits);
            };

            // Adicionar novo hábito
            const addHabit = () => {
                if (!newHabitName.trim()) return;
                
                const monthKey = `${currentYear}-${currentMonth}`;
                const newHabit = {
                    id: Date.now(),
                    name: newHabitName.trim(),
                    priority: "medium",
                    daysType: "all"
                };

                setHabits(prev => ({
                    ...prev,
                    [monthKey]: [...(prev[monthKey] || []), newHabit]
                }));

                setNewHabitName('');
                setShowAddForm(false);
            };

            // Toggle hábito para um dia
            const toggleHabit = (habitId, day) => {
                const key = `${habitId}-${currentYear}-${currentMonth}-${day}`;
                setHabitData(prev => ({
                    ...prev,
                    [key]: !prev[key]
                }));
            };

            // Verificar se hábito foi completado
            const isHabitCompleted = (habitId, day) => {
                const key = `${habitId}-${currentYear}-${currentMonth}-${day}`;
                return habitData[key] || false;
            };

            // Constantes
            const monthNames = [
                "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
                "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
            ];

            const currentMonthHabits = habits[`${currentYear}-${currentMonth}`] || [];
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

            // Render condicional para carregamento
            if (!isInitialized) {
                return React.createElement('div', {
                    className: 'min-h-screen bg-gray-900 flex items-center justify-center'
                }, React.createElement('div', {
                    className: 'text-white text-center'
                }, [
                    React.createElement('div', { key: 'emoji', className: 'text-6xl mb-4' }, '📊'),
                    React.createElement('div', { key: 'text', className: 'text-2xl' }, 'Inicializando...')
                ]));
            }

            // Render principal
            return React.createElement('div', {
                className: 'min-h-screen bg-gray-900 p-4'
            }, [
                // Header
                React.createElement('div', {
                    key: 'header',
                    className: 'text-center mb-8'
                }, [
                    React.createElement('h1', {
                        key: 'title',
                        className: 'text-4xl md:text-6xl font-black mb-4 text-white'
                    }, '📊 RASTREADOR DE HÁBITOS'),

                    React.createElement('div', {
                        key: 'subtitle',
                        className: 'text-green-400 text-lg mb-4'
                    }, '✅ Aplicação funcionando perfeitamente!'),

                    // Status de salvamento
                    React.createElement('div', {
                        key: 'save-status',
                        className: 'inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gray-800 border border-gray-600 mb-6'
                    }, [
                        React.createElement('span', {
                            key: 'save-icon',
                            className: `w-3 h-3 rounded-full ${saveStatus === 'saving' ? 'bg-blue-400 animate-pulse' : saveStatus === 'saved' ? 'bg-green-400' : 'bg-red-400'}`
                        }),
                        React.createElement('span', {
                            key: 'save-text',
                            className: 'text-white text-sm'
                        }, saveStatus === 'saving' ? 'Salvando...' : saveStatus === 'saved' ? 'Dados salvos' : 'Erro ao salvar')
                    ]),

                    // Navegação de mês
                    React.createElement('div', {
                        key: 'month-nav',
                        className: 'flex items-center justify-center gap-4 mb-6'
                    }, [
                        React.createElement('button', {
                            key: 'prev',
                            onClick: () => {
                                if (currentMonth === 0) {
                                    setCurrentMonth(11);
                                    setCurrentYear(currentYear - 1);
                                } else {
                                    setCurrentMonth(currentMonth - 1);
                                }
                            },
                            className: 'px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors'
                        }, '← Anterior'),

                        React.createElement('div', {
                            key: 'current-month',
                            className: 'px-6 py-2 bg-gray-800 text-white rounded-lg font-bold'
                        }, `${monthNames[currentMonth]} ${currentYear}`),

                        React.createElement('button', {
                            key: 'next',
                            onClick: () => {
                                if (currentMonth === 11) {
                                    setCurrentMonth(0);
                                    setCurrentYear(currentYear + 1);
                                } else {
                                    setCurrentMonth(currentMonth + 1);
                                }
                            },
                            className: 'px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors'
                        }, 'Próximo →')
                    ])
                ]),

                // Área principal
                React.createElement('div', {
                    key: 'main',
                    className: 'max-w-6xl mx-auto'
                }, [
                    // Se não há hábitos
                    currentMonthHabits.length === 0 && React.createElement('div', {
                        key: 'no-habits',
                        className: 'text-center py-12'
                    }, [
                        React.createElement('div', {
                            key: 'empty-emoji',
                            className: 'text-6xl mb-4'
                        }, '📅'),

                        React.createElement('h2', {
                            key: 'empty-title',
                            className: 'text-2xl font-bold text-gray-300 mb-4'
                        }, 'Nenhum hábito configurado'),

                        React.createElement('p', {
                            key: 'empty-text',
                            className: 'text-gray-400 mb-6'
                        }, 'Comece criando alguns hábitos para acompanhar seu progresso!'),

                        React.createElement('div', {
                            key: 'empty-actions',
                            className: 'flex gap-4 justify-center'
                        }, [
                            React.createElement('button', {
                                key: 'create-examples',
                                onClick: createExampleHabits,
                                className: 'px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors'
                            }, '🚀 Criar Hábitos de Exemplo'),

                            React.createElement('button', {
                                key: 'add-custom',
                                onClick: () => setShowAddForm(true),
                                className: 'px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors'
                            }, '➕ Adicionar Hábito')
                        ])
                    ]),

                    // Lista de hábitos
                    currentMonthHabits.length > 0 && React.createElement('div', {
                        key: 'habits-section',
                        className: 'grid lg:grid-cols-2 gap-6'
                    }, [
                        // Lista de hábitos
                        React.createElement('div', {
                            key: 'habits-list',
                            className: 'bg-gray-800 rounded-xl p-6'
                        }, [
                            React.createElement('div', {
                                key: 'habits-header',
                                className: 'flex items-center justify-between mb-4'
                            }, [
                                React.createElement('h3', {
                                    key: 'habits-title',
                                    className: 'text-xl font-bold text-white'
                                }, `Hábitos - ${monthNames[currentMonth]}`),

                                React.createElement('button', {
                                    key: 'add-habit-btn',
                                    onClick: () => setShowAddForm(true),
                                    className: 'px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded text-sm transition-colors'
                                }, '+ Adicionar')
                            ]),

                            React.createElement('div', {
                                key: 'habits-grid',
                                className: 'space-y-3'
                            }, currentMonthHabits.map(habit => 
                                React.createElement('div', {
                                    key: habit.id,
                                    className: 'bg-gray-700 rounded-lg p-4'
                                }, [
                                    React.createElement('div', {
                                        key: 'habit-name',
                                        className: 'font-medium text-white mb-2'
                                    }, habit.name),

                                    React.createElement('div', {
                                        key: 'habit-progress',
                                        className: 'text-sm text-gray-300'
                                    }, `${habit.priority === 'high' ? '🚩' : habit.priority === 'medium' ? '🟡' : '🏳️'} ${habit.priority === 'high' ? 'Alta' : habit.priority === 'medium' ? 'Média' : 'Baixa'} prioridade`)
                                ])
                            ))
                        ]),

                        // Calendário simples
                        React.createElement('div', {
                            key: 'calendar',
                            className: 'bg-gray-800 rounded-xl p-6'
                        }, [
                            React.createElement('h3', {
                                key: 'calendar-title',
                                className: 'text-xl font-bold text-white mb-4'
                            }, 'Calendário do Mês'),

                            React.createElement('div', {
                                key: 'calendar-grid',
                                className: 'grid grid-cols-7 gap-2'
                            }, [
                                // Dias da semana
                                ...['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'].map(day =>
                                    React.createElement('div', {
                                        key: day,
                                        className: 'text-center text-xs font-medium text-gray-400 p-2'
                                    }, day)
                                ),

                                // Dias do mês
                                ...Array.from({ length: daysInMonth }, (_, i) => {
                                    const day = i + 1;
                                    const isToday = day === new Date().getDate() && 
                                                   currentMonth === new Date().getMonth() && 
                                                   currentYear === new Date().getFullYear();
                                    
                                    return React.createElement('div', {
                                        key: day,
                                        className: `text-center p-2 rounded cursor-pointer transition-colors ${
                                            isToday ? 'bg-blue-600 text-white' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                        }`
                                    }, day.toString());
                                })
                            ])
                        ])
                    ])
                ]),

                // Modal de adicionar hábito
                showAddForm && React.createElement('div', {
                    key: 'add-modal',
                    className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50',
                    onClick: (e) => {
                        if (e.target === e.currentTarget) {
                            setShowAddForm(false);
                            setNewHabitName('');
                        }
                    }
                }, React.createElement('div', {
                    className: 'bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4'
                }, [
                    React.createElement('h3', {
                        key: 'modal-title',
                        className: 'text-xl font-bold text-white mb-4'
                    }, 'Adicionar Novo Hábito'),

                    React.createElement('input', {
                        key: 'modal-input',
                        type: 'text',
                        value: newHabitName,
                        onChange: (e) => setNewHabitName(e.target.value),
                        onKeyPress: (e) => {
                            if (e.key === 'Enter') addHabit();
                        },
                        placeholder: 'Nome do hábito (ex: Meditar 🧘‍♂️)',
                        className: 'w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4',
                        autoFocus: true
                    }),

                    React.createElement('div', {
                        key: 'modal-actions',
                        className: 'flex gap-3'
                    }, [
                        React.createElement('button', {
                            key: 'modal-save',
                            onClick: addHabit,
                            disabled: !newHabitName.trim(),
                            className: 'flex-1 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg transition-colors'
                        }, 'Adicionar'),

                        React.createElement('button', {
                            key: 'modal-cancel',
                            onClick: () => {
                                setShowAddForm(false);
                                setNewHabitName('');
                            },
                            className: 'flex-1 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors'
                        }, 'Cancelar')
                    ])
                ]))
            ]);
        };

        // Render da aplicação
        try {
            console.log('🎯 Iniciando renderização...');
            const container = document.getElementById('root');
            const root = ReactDOM.createRoot(container);
            root.render(React.createElement(HabitTracker));
            console.log('✅ Aplicação renderizada com sucesso!');
        } catch (error) {
            console.error('❌ Erro crítico na renderização:', error);
            document.getElementById('root').innerHTML = `
                <div style="color: white; padding: 40px; text-align: center; background: #111827; min-height: 100vh; display: flex; align-items: center; justify-content: center;">
                    <div>
                        <h1 style="color: #ef4444; font-size: 2em; margin-bottom: 20px;">❌ Erro de Renderização</h1>
                        <p style="color: #6b7280; margin-bottom: 20px;">Detalhes do erro:</p>
                        <pre style="background: #1f2937; padding: 20px; border-radius: 8px; text-align: left; overflow: auto; color: #f3f4f6;">${error.message}</pre>
                        <p style="color: #9ca3af; margin-top: 20px; font-size: 0.9em;">Abra o console (F12) para mais informações técnicas</p>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
