<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸš€ Rastreador de HÃ¡bitos Circular - VersÃ£o 2707</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
        
        /* TÃ­tulo retro typewriter */
        .typewriter-title {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(34, 211, 238, 0.5);
        }
        
        .typewriter-cursor {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        /* Scrollbars customizadas */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(34, 211, 238, 0.3);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(34, 211, 238, 0.5);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ðŸš€ RASTREADOR DE HÃBITOS CIRCULAR - VERSÃƒO 2707
        // âœ… Sistema completo de persistÃªncia com localStorage
        // âœ… Auto-save inteligente (beforeunload, visibilitychange, intervalos)
        // âœ… CalendÃ¡rio circular interativo com rotaÃ§Ã£o
        // âœ… Timeline horizontal com 24 horas
        // âœ… Sistema de streaks em tempo real
        // âœ… EstatÃ­sticas avanÃ§adas e filtros
        // âœ… Backup/Restore completo em JSON
        // âœ… TÃ­tulo estilo mÃ¡quina de escrever retro
        // âœ… Tema escuro profissional
        // âœ… CompatÃ­vel 100% com GitHub Pages

        const { useState, useEffect, useCallback, useRef, useMemo } = React;

        // ðŸŽ¯ SISTEMA DE ÃCONES COMPATÃVEL - Font Awesome
        const Icons = {
            Plus: () => <i className="fas fa-plus w-4 h-4"></i>,
            Settings: () => <i className="fas fa-cog w-4 h-4"></i>,
            Calendar: () => <i className="fas fa-calendar-alt w-4 h-4"></i>,
            Edit2: () => <i className="fas fa-edit w-4 h-4"></i>,
            Trash2: () => <i className="fas fa-trash w-4 h-4"></i>,
            BarChart3: () => <i className="fas fa-chart-bar w-4 h-4"></i>,
            Target: () => <i className="fas fa-bullseye w-4 h-4"></i>,
            TrendingUp: () => <i className="fas fa-chart-line w-4 h-4"></i>,
            Filter: () => <i className="fas fa-filter w-4 h-4"></i>,
            Search: () => <i className="fas fa-search w-4 h-4"></i>,
            RefreshCw: () => <i className="fas fa-sync-alt w-4 h-4"></i>,
            Eye: () => <i className="fas fa-eye w-4 h-4"></i>,
            Flame: () => <i className="fas fa-fire w-4 h-4"></i>,
            Trophy: () => <i className="fas fa-trophy w-4 h-4"></i>,
            Clock: () => <i className="fas fa-clock w-4 h-4"></i>,
            Save: () => <i className="fas fa-save w-4 h-4"></i>,
            CheckCircle: () => <i className="fas fa-check-circle w-4 h-4"></i>,
            AlertCircle: () => <i className="fas fa-exclamation-circle w-4 h-4"></i>,
            Download: () => <i className="fas fa-download w-4 h-4"></i>,
            Upload: () => <i className="fas fa-upload w-4 h-4"></i>,
            X: () => <i className="fas fa-times w-4 h-4"></i>,
            ChevronLeft: () => <i className="fas fa-chevron-left w-4 h-4"></i>,
            ChevronRight: () => <i className="fas fa-chevron-right w-4 h-4"></i>,
            Database: () => <i className="fas fa-database w-4 h-4"></i>
        };

        const CircularHabitCalendar = () => {
            const [currentMonth, setCurrentMonth] = useState(new Date().getMonth());
            const [currentYear, setCurrentYear] = useState(new Date().getFullYear());
            const [monthlyHabits, setMonthlyHabits] = useState({});
            const [habitData, setHabitData] = useState({});
            const [newHabit, setNewHabit] = useState('');
            const [selectedPriority, setSelectedPriority] = useState('medium');
            const [selectedDaysType, setSelectedDaysType] = useState('all');
            const [showAddForm, setShowAddForm] = useState(false);
            const [hoveredDay, setHoveredDay] = useState(null);
            const [hoveredHabit, setHoveredHabit] = useState(null);
            const [priorityFilter, setPriorityFilter] = useState('all');
            const [searchTerm, setSearchTerm] = useState('');
            const [showStats, setShowStats] = useState(false);
            const [focusedDay, setFocusedDay] = useState(null);
            const [rotationAngle, setRotationAngle] = useState(0);
            const [showStreaks] = useState(true);
            const [animations] = useState(true);
            const [compactMode] = useState(true);
            const [selectedHabitId, setSelectedHabitId] = useState(null);
            const [resetStatus, setResetStatus] = useState('');
            const [expandedHabitDetails, setExpandedHabitDetails] = useState(null);
            const [selectedScheduleTime, setSelectedScheduleTime] = useState('');
            const [selectedNotificationPref, setSelectedNotificationPref] = useState('onTime');
            const [editingHabitId, setEditingHabitId] = useState(null);
            const [editForm, setEditForm] = useState({
                name: '',
                priority: '',
                daysType: ''
            });

            // ðŸŽ¯ SISTEMA DE SALVAMENTO AUTOMÃTICO
            const [saveStatus, setSaveStatus] = useState('idle');
            const [lastSaveTime, setLastSaveTime] = useState(null);
            const [autoSaveEnabled, setAutoSaveEnabled] = useState(true);
            const [showDataManager, setShowDataManager] = useState(false);
            const saveTimeoutRef = useRef(null);

            // ðŸŽ¯ SISTEMA DE TIMELINE
            const [currentTime, setCurrentTime] = useState(new Date());
            const [overdueCount, setOverdueCount] = useState(0);
            const [snoozedHabits, setSnoozedHabits] = useState({});
            const [overdueNotificationClosed, setOverdueNotificationClosed] = useState(false);
            const [isTimelineExpanded, setIsTimelineExpanded] = useState(false);
            const [timelineForceUpdate, setTimelineForceUpdate] = useState(0);

            // Timeline refs para otimizaÃ§Ã£o
            const timelineScrollRef = useRef(null);
            const timelineInitialScrollDoneRef = useRef(false);
            const timelineUserInteractedRef = useRef(false);
            const savedScrollPositionRef = useRef(0);
            const timelineVersionRef = useRef(0);
            const timelineDataRef = useRef({
                todayHabits: [],
                completionSnapshot: {},
                isCurrentMonth: false,
                currentHour: 0,
                lastUpdate: 0
            });

            // ðŸŽ¯ CONSTANTES DO SISTEMA
            const STORAGE_KEYS = {
                monthlyHabits: 'habitTracker_monthlyHabits_v2',
                habitData: 'habitTracker_habitData_v2',
                snoozedHabits: 'habitTracker_snoozedHabits',
                overdueNotificationClosed: 'habitTracker_overdueNotificationClosed',
                autoSave: 'habitTracker_autoSave',
                timelineExpanded: 'habitTracker_timelineExpanded'
            };

            // ðŸŽ¯ SISTEMA DE TÃTULO TYPEWRITER
            const [displayText, setDisplayText] = useState('');
            const [currentIndex, setCurrentIndex] = useState(0);
            const [showCursor, setShowCursor] = useState(true);
            const fullText = "ðŸš€ RASTREADOR DE HÃBITOS CIRCULAR - v2707";

            useEffect(() => {
                if (currentIndex < fullText.length) {
                    const timer = setTimeout(() => {
                        setDisplayText(fullText.slice(0, currentIndex + 1));
                        setCurrentIndex(currentIndex + 1);
                    }, 80);
                    return () => clearTimeout(timer);
                }
            }, [currentIndex, fullText]);

            useEffect(() => {
                const cursor = setInterval(() => {
                    setShowCursor(prev => !prev);
                }, 600);
                return () => clearInterval(cursor);
            }, []);

            // ðŸŽ¯ FUNÃ‡Ã•ES DE PERSISTÃŠNCIA
            const saveToLocalStorage = useCallback((key, data, immediate = false) => {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    if (immediate) {
                        setSaveStatus('saved');
                        setLastSaveTime(Date.now());
                    }
                    return true;
                } catch (error) {
                    console.error('Erro ao salvar no localStorage:', error);
                    setSaveStatus('error');
                    return false;
                }
            }, []);

            const loadFromLocalStorage = useCallback((key) => {
                try {
                    const item = localStorage.getItem(key);
                    return item ? JSON.parse(item) : null;
                } catch (error) {
                    console.error('Erro ao carregar do localStorage:', error);
                    return null;
                }
            }, []);

            // ðŸŽ¯ AUTO-SAVE INTELIGENTE
            const autoSave = useCallback((immediate = false) => {
                if (!autoSaveEnabled && !immediate) return;

                setSaveStatus('saving');

                try {
                    saveToLocalStorage(STORAGE_KEYS.monthlyHabits, monthlyHabits, true);
                    saveToLocalStorage(STORAGE_KEYS.habitData, habitData, true);
                    saveToLocalStorage(STORAGE_KEYS.snoozedHabits, snoozedHabits, true);
                    saveToLocalStorage(STORAGE_KEYS.overdueNotificationClosed, overdueNotificationClosed, true);
                    saveToLocalStorage(STORAGE_KEYS.autoSave, autoSaveEnabled, true);
                    saveToLocalStorage(STORAGE_KEYS.timelineExpanded, isTimelineExpanded, true);

                    setSaveStatus('saved');
                    setLastSaveTime(Date.now());
                } catch (error) {
                    setSaveStatus('error');
                }
            }, [
                autoSaveEnabled, monthlyHabits, habitData, snoozedHabits, 
                overdueNotificationClosed, isTimelineExpanded, saveToLocalStorage
            ]);

            // ðŸŽ¯ CARREGAR DADOS AO INICIALIZAR
            const loadSavedData = useCallback(() => {
                try {
                    setSaveStatus('loading');

                    const savedMonthlyHabits = loadFromLocalStorage(STORAGE_KEYS.monthlyHabits);
                    const savedHabitData = loadFromLocalStorage(STORAGE_KEYS.habitData);
                    const savedSnoozedHabits = loadFromLocalStorage(STORAGE_KEYS.snoozedHabits);
                    const savedOverdueNotificationClosed = loadFromLocalStorage(STORAGE_KEYS.overdueNotificationClosed);
                    const savedAutoSave = loadFromLocalStorage(STORAGE_KEYS.autoSave);
                    const savedTimelineExpanded = loadFromLocalStorage(STORAGE_KEYS.timelineExpanded);

                    if (savedMonthlyHabits) setMonthlyHabits(savedMonthlyHabits);
                    if (savedHabitData) setHabitData(savedHabitData);
                    if (savedSnoozedHabits) setSnoozedHabits(savedSnoozedHabits);
                    if (savedOverdueNotificationClosed !== null) setOverdueNotificationClosed(savedOverdueNotificationClosed);
                    if (savedAutoSave !== null) setAutoSaveEnabled(savedAutoSave);
                    if (savedTimelineExpanded !== null) setIsTimelineExpanded(savedTimelineExpanded);

                    setSaveStatus('saved');
                    setLastSaveTime(Date.now());
                    return true;
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                    setSaveStatus('error');
                    return false;
                }
            }, [loadFromLocalStorage]);

            // ðŸŽ¯ INICIALIZAR APP
            useEffect(() => {
                loadSavedData();
            }, [loadSavedData]);

            // ðŸŽ¯ AUTO-SAVE PROGRAMADO
            useEffect(() => {
                if (saveTimeoutRef.current) {
                    clearTimeout(saveTimeoutRef.current);
                }

                saveTimeoutRef.current = setTimeout(() => {
                    autoSave();
                }, 2000);

                return () => {
                    if (saveTimeoutRef.current) {
                        clearTimeout(saveTimeoutRef.current);
                    }
                };
            }, [monthlyHabits, habitData, snoozedHabits, overdueNotificationClosed, autoSave]);

            // ðŸŽ¯ SALVAMENTO AO SAIR
            useEffect(() => {
                const handleBeforeUnload = (e) => {
                    autoSave(true);
                    if (saveStatus === 'saving') {
                        e.preventDefault();
                        e.returnValue = 'Dados sendo salvos...';
                        return 'Dados sendo salvos...';
                    }
                };

                const handleVisibilityChange = () => {
                    if (document.visibilityState === 'hidden') {
                        autoSave(true);
                    }
                };

                const handleUnload = () => {
                    autoSave(true);
                };

                window.addEventListener('beforeunload', handleBeforeUnload);
                window.addEventListener('unload', handleUnload);
                document.addEventListener('visibilitychange', handleVisibilityChange);

                return () => {
                    window.removeEventListener('beforeunload', handleBeforeUnload);
                    window.removeEventListener('unload', handleUnload);
                    document.removeEventListener('visibilitychange', handleVisibilityChange);

                    if (saveTimeoutRef.current) {
                        clearTimeout(saveTimeoutRef.current);
                    }
                    autoSave(true);
                };
            }, [autoSave, saveStatus]);

            // ðŸŽ¯ FUNÃ‡Ã•ES CORE DO SISTEMA
            const getCurrentMonthKey = () => `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`;

            const getHabitsForCurrentMonth = () => {
                const monthKey = getCurrentMonthKey();
                return monthlyHabits[monthKey] || [];
            };

            const toggleHabitDay = useCallback((habitId, day) => {
                const key = `${habitId}-${currentYear}-${currentMonth}-${day}`;
                setHabitData(prev => ({
                    ...prev,
                    [key]: !prev[key]
                }));
            }, [currentMonth, currentYear]);

            const addHabit = () => {
                if (!newHabit.trim()) return;

                const habitId = Date.now().toString();
                const monthKey = getCurrentMonthKey();
                const habit = {
                    id: habitId,
                    name: newHabit.trim(),
                    priority: selectedPriority,
                    daysType: selectedDaysType,
                    scheduleTime: selectedScheduleTime || null,
                    notificationPreference: selectedNotificationPref,
                    createdAt: new Date().toISOString(),
                    currentStreak: 0,
                    bestStreak: 0,
                    lastNotified: null,
                    observations: ['', '', '']
                };

                setMonthlyHabits(prev => ({
                    ...prev,
                    [monthKey]: [...(prev[monthKey] || []), habit]
                }));

                setNewHabit('');
                setSelectedScheduleTime('');
                setSelectedNotificationPref('onTime');
                setShowAddForm(false);
            };

            const deleteHabit = (habitId) => {
                const monthKey = getCurrentMonthKey();
                setMonthlyHabits(prev => ({
                    ...prev,
                    [monthKey]: (prev[monthKey] || []).filter(h => h.id !== habitId)
                }));

                // Remover dados de completamento
                setHabitData(prev => {
                    const newData = { ...prev };
                    Object.keys(newData).forEach(key => {
                        if (key.startsWith(habitId + '-')) {
                            delete newData[key];
                        }
                    });
                    return newData;
                });
            };

            // ðŸŽ¯ SISTEMA DE STREAKS
            const calculateStreak = useCallback((habitId) => {
                const today = new Date();
                const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
                let currentStreak = 0;
                let bestStreak = 0;
                let tempStreak = 0;

                // Calcular streak atual (contando de trÃ¡s para frente)
                for (let day = today.getDate(); day >= 1; day--) {
                    const key = `${habitId}-${currentYear}-${currentMonth}-${day}`;
                    if (habitData[key]) {
                        currentStreak++;
                    } else {
                        break;
                    }
                }

                // Calcular melhor streak do mÃªs
                for (let day = 1; day <= daysInMonth; day++) {
                    const key = `${habitId}-${currentYear}-${currentMonth}-${day}`;
                    if (habitData[key]) {
                        tempStreak++;
                        bestStreak = Math.max(bestStreak, tempStreak);
                    } else {
                        tempStreak = 0;
                    }
                }

                return { currentStreak, bestStreak };
            }, [habitData, currentMonth, currentYear]);

            // ðŸŽ¯ SISTEMA DE FILTROS
            const filteredHabits = useMemo(() => {
                let habits = getHabitsForCurrentMonth();

                if (priorityFilter !== 'all') {
                    habits = habits.filter(h => h.priority === priorityFilter);
                }

                if (searchTerm.trim()) {
                    habits = habits.filter(h => 
                        h.name.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                }

                return habits;
            }, [monthlyHabits, currentMonth, currentYear, priorityFilter, searchTerm]);

            // ðŸŽ¯ ESTATÃSTICAS DO MÃŠS
            const getMonthlyStats = () => {
                const habits = getHabitsForCurrentMonth();
                const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
                const today = new Date();
                const isCurrentMonth = today.getMonth() === currentMonth && today.getFullYear() === currentYear;
                const maxDay = isCurrentMonth ? today.getDate() : daysInMonth;

                let totalPossible = 0;
                let totalCompleted = 0;

                habits.forEach(habit => {
                    for (let day = 1; day <= maxDay; day++) {
                        totalPossible++;
                        const key = `${habit.id}-${currentYear}-${currentMonth}-${day}`;
                        if (habitData[key]) {
                            totalCompleted++;
                        }
                    }
                });

                const completionRate = totalPossible > 0 ? (totalCompleted / totalPossible) * 100 : 0;

                return {
                    totalHabits: habits.length,
                    totalCompleted,
                    totalPossible,
                    completionRate: Math.round(completionRate),
                    daysInMonth,
                    maxDay
                };
            };

            // ðŸŽ¯ CALENDÃRIO CIRCULAR
            const generateCircularCalendar = () => {
                const habits = filteredHabits;
                const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
                const today = new Date();
                const isToday = (day) => {
                    return today.getDate() === day && 
                           today.getMonth() === currentMonth && 
                           today.getFullYear() === currentYear;
                };

                const centerX = 300;
                const centerY = 300;
                const baseRadius = 80;
                const ringSpacing = 35;
                const svgSize = 600;

                const fixedElements = [];
                const rotatingElements = [];

                // Centro do calendÃ¡rio
                fixedElements.push(
                    <circle key="center-bg" cx={centerX} cy={centerY} r="70" fill="rgba(30, 41, 59, 0.9)" stroke="rgba(34, 211, 238, 0.3)" strokeWidth="2" />,
                    <text key="month" x={centerX} y={centerY - 10} textAnchor="middle" fill="rgba(34, 211, 238, 0.9)" fontSize="18" fontWeight="bold">
                        {new Date(currentYear, currentMonth).toLocaleDateString('pt-BR', { month: 'long' }).toUpperCase()}
                    </text>,
                    <text key="year" x={centerX} y={centerY + 15} textAnchor="middle" fill="rgba(156, 163, 175, 0.8)" fontSize="14">
                        {currentYear}
                    </text>
                );

                // NÃºmeros dos dias
                for (let day = 1; day <= daysInMonth; day++) {
                    const angle = ((day - 1) / daysInMonth) * 2 * Math.PI - Math.PI / 2;
                    const x = centerX + (baseRadius - 15) * Math.cos(angle);
                    const y = centerY + (baseRadius - 15) * Math.sin(angle);

                    rotatingElements.push(
                        <text
                            key={`day-${day}`}
                            x={x}
                            y={y + 5}
                            textAnchor="middle"
                            fill={isToday(day) ? "#ef4444" : "#94a3b8"}
                            fontSize="12"
                            fontWeight={isToday(day) ? "bold" : "normal"}
                        >
                            {day}
                        </text>
                    );
                }

                // AnÃ©is dos hÃ¡bitos
                habits.forEach((habit, habitIndex) => {
                    const radius = baseRadius + (habitIndex + 1) * ringSpacing;
                    const priorityColors = {
                        high: { fill: "#dc2626", stroke: "#ef4444" },
                        medium: { fill: "#ea580c", stroke: "#f97316" }, 
                        low: { fill: "#0891b2", stroke: "#06b6d4" }
                    };
                    const colors = priorityColors[habit.priority];

                    for (let day = 1; day <= daysInMonth; day++) {
                        const angle = ((day - 1) / daysInMonth) * 2 * Math.PI - Math.PI / 2;
                        const x = centerX + radius * Math.cos(angle);
                        const y = centerY + radius * Math.sin(angle);

                        const key = `${habit.id}-${currentYear}-${currentMonth}-${day}`;
                        const isCompleted = habitData[key];
                        const isHovered = hoveredDay === day && hoveredHabit === habit.id;

                        const pathData = `M ${x-8} ${y-8} L ${x+8} ${y-8} L ${x+8} ${y+8} L ${x-8} ${y+8} Z`;

                        rotatingElements.push(
                            <path
                                key={`${habit.id}-${day}`}
                                d={pathData}
                                fill={isCompleted ? colors.stroke : "rgba(55, 65, 81, 0.7)"}
                                stroke={isCompleted ? colors.stroke : colors.fill}
                                strokeWidth={isHovered ? "3" : "2"}
                                className="cursor-pointer transition-all duration-200"
                                style={{
                                    opacity: isCompleted ? 1 : 0.6,
                                    filter: isCompleted ? 'drop-shadow(0 2px 4px rgba(0,0,0,0.3))' : 'none'
                                }}
                                onClick={(e) => {
                                    e.stopPropagation();
                                    toggleHabitDay(habit.id, day);
                                }}
                                onMouseEnter={() => {
                                    setHoveredDay(day);
                                    setHoveredHabit(habit.id);
                                }}
                                onMouseLeave={() => {
                                    setHoveredDay(null);
                                    setHoveredHabit(null);
                                }}
                            />
                        );
                    }
                });

                return { fixedElements, rotatingElements, svgSize };
            };

            // ðŸŽ¯ BACKUP E RESTORE
            const createBackup = () => {
                try {
                    const backupData = {
                        version: '2707',
                        timestamp: new Date().toISOString(),
                        monthlyHabits,
                        habitData,
                        snoozedHabits,
                        overdueNotificationClosed,
                        settings: {
                            autoSaveEnabled,
                            priorityFilter,
                            searchTerm,
                            isTimelineExpanded
                        }
                    };

                    const backupString = JSON.stringify(backupData, null, 2);
                    const blob = new Blob([backupString], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);

                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `habit-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    setSaveStatus('saved');
                    setTimeout(() => setSaveStatus('saved'), 3000);
                } catch (error) {
                    setSaveStatus('error');
                    setTimeout(() => setSaveStatus('saved'), 3000);
                }
            };

            const restoreBackup = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const backupData = JSON.parse(e.target.result);

                        if (backupData.version && backupData.monthlyHabits) {
                            setMonthlyHabits(backupData.monthlyHabits || {});
                            setHabitData(backupData.habitData || {});
                            setSnoozedHabits(backupData.snoozedHabits || {});
                            setOverdueNotificationClosed(backupData.overdueNotificationClosed || false);

                            if (backupData.settings) {
                                setAutoSaveEnabled(backupData.settings.autoSaveEnabled ?? true);
                                setPriorityFilter(backupData.settings.priorityFilter || 'all');
                                setSearchTerm(backupData.settings.searchTerm || '');
                                setIsTimelineExpanded(backupData.settings.isTimelineExpanded || false);
                            }

                            autoSave(true);
                            setSaveStatus('saved');
                            alert('Backup restaurado com sucesso!');
                        } else {
                            alert('Arquivo de backup invÃ¡lido.');
                        }
                    } catch (error) {
                        alert('Erro ao restaurar backup: ' + error.message);
                    }
                };
                reader.readAsText(file);

                // Limpar input
                event.target.value = '';
            };

            // ðŸŽ¯ RESET COMPLETO
            const resetAllData = () => {
                if (!confirm('âš ï¸ ATENÃ‡ÃƒO: Isso irÃ¡ apagar TODOS os dados permanentemente. Tem certeza?')) return;

                try {
                    const defaultHabits = {};

                    setResetStatus('ðŸ”„ Resetando interface...');

                    setHabitData({});
                    setMonthlyHabits(defaultHabits);
                    setPriorityFilter('all');
                    setSearchTerm('');
                    setSelectedHabitId(null);
                    setExpandedHabitDetails(null);
                    setFocusedDay(null);
                    setRotationAngle(0);
                    setShowStats(false);
                    setShowAddForm(false);
                    setSnoozedHabits({});
                    setOverdueCount(0);
                    setSelectedScheduleTime('');
                    setSelectedNotificationPref('onTime');
                    setOverdueNotificationClosed(false);
                    setEditingHabitId(null);
                    setEditForm({ name: '', priority: '', daysType: '' });
                    setAutoSaveEnabled(true);
                    setShowDataManager(false);

                    // Limpar localStorage
                    Object.values(STORAGE_KEYS).forEach(key => {
                        localStorage.removeItem(key);
                    });

                    setResetStatus('âœ… Reset completo realizado!');

                    setTimeout(() => {
                        setResetStatus('');
                    }, 3000);

                } catch (error) {
                    setResetStatus('âŒ Erro no reset - recarregando...');
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                }
            };

            // ðŸŽ¯ RENDERIZAR DADOS
            const stats = getMonthlyStats();
            const { fixedElements, rotatingElements, svgSize } = generateCircularCalendar();

            // ðŸŽ¯ COMPONENTE DE STATUS DE SALVAMENTO
            const SaveStatusIndicator = () => {
                const getStatusIcon = () => {
                    switch (saveStatus) {
                        case 'saving':
                            return <Icons.Save />;
                        case 'saved':
                            return <Icons.CheckCircle />;
                        case 'error':
                            return <Icons.AlertCircle />;
                        default:
                            return <Icons.Save />;
                    }
                };

                const getStatusText = () => {
                    switch (saveStatus) {
                        case 'saving':
                            return 'Salvando...';
                        case 'saved':
                            return lastSaveTime ? 
                                `Salvo ${new Date(lastSaveTime).toLocaleTimeString()}` : 
                                'Dados salvos';
                        case 'error':
                            return 'Erro ao salvar';
                        case 'loading':
                            return 'Carregando...';
                        default:
                            return 'Pronto para salvar';
                    }
                };

                const getStatusColor = () => {
                    switch (saveStatus) {
                        case 'saving':
                            return 'text-blue-400';
                        case 'saved':
                            return 'text-green-400';
                        case 'error':
                            return 'text-red-400';
                        case 'loading':
                            return 'text-yellow-400';
                        default:
                            return 'text-gray-400';
                    }
                };

                return (
                    <div className={`flex items-center gap-2 ${getStatusColor()}`}>
                        <div className={saveStatus === 'saving' ? 'animate-spin' : ''}>
                            {getStatusIcon()}
                        </div>
                        <span className="text-xs">{getStatusText()}</span>
                    </div>
                );
            };

            // ðŸŽ¯ RENDER PRINCIPAL
            return (
                <div className="min-h-screen p-4 space-y-6">
                    {/* TÃ­tulo Typewriter */}
                    <div className="text-center mb-8">
                        <h1 className="typewriter-title text-2xl md:text-4xl text-cyan-400 mb-2">
                            {displayText}
                            <span className={`typewriter-cursor ${showCursor ? 'opacity-100' : 'opacity-0'}`}>|</span>
                        </h1>
                        <p className="text-gray-400 text-sm">
                            Sistema completo de rastreamento de hÃ¡bitos com calendÃ¡rio circular interativo
                        </p>
                    </div>

                    {/* Header com controles */}
                    <div className="bg-gray-800/50 backdrop-blur-xl rounded-3xl p-6 border border-gray-700 shadow-2xl">
                        <div className="flex flex-wrap items-center justify-between gap-4 mb-4">
                            <div className="flex items-center gap-4">
                                <button
                                    onClick={() => setCurrentMonth(prev => prev === 0 ? 11 : prev - 1)}
                                    className="p-2 bg-gray-700 hover:bg-gray-600 rounded-xl transition-colors"
                                    onClickCapture={() => {
                                        if (currentMonth === 0) setCurrentYear(prev => prev - 1);
                                    }}
                                >
                                    <Icons.ChevronLeft />
                                </button>
                                
                                <div className="text-center">
                                    <h2 className="text-xl font-bold text-white">
                                        {new Date(currentYear, currentMonth).toLocaleDateString('pt-BR', { 
                                            month: 'long', 
                                            year: 'numeric' 
                                        })}
                                    </h2>
                                </div>
                                
                                <button
                                    onClick={() => setCurrentMonth(prev => prev === 11 ? 0 : prev + 1)}
                                    className="p-2 bg-gray-700 hover:bg-gray-600 rounded-xl transition-colors"
                                    onClickCapture={() => {
                                        if (currentMonth === 11) setCurrentYear(prev => prev + 1);
                                    }}
                                >
                                    <Icons.ChevronRight />
                                </button>
                            </div>

                            <div className="flex items-center gap-3">
                                <SaveStatusIndicator />
                                
                                <button
                                    onClick={() => setShowStats(!showStats)}
                                    className="p-2 bg-blue-600 hover:bg-blue-700 rounded-xl transition-colors"
                                >
                                    <Icons.BarChart3 />
                                </button>
                                
                                <button
                                    onClick={() => setShowDataManager(!showDataManager)}
                                    className="p-2 bg-purple-600 hover:bg-purple-700 rounded-xl transition-colors"
                                >
                                    <Icons.Database />
                                </button>
                            </div>
                        </div>

                        {/* Filtros */}
                        <div className="flex flex-wrap gap-3 mb-4">
                            <select
                                value={priorityFilter}
                                onChange={(e) => setPriorityFilter(e.target.value)}
                                className="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm"
                            >
                                <option value="all">Todas as prioridades</option>
                                <option value="high">ðŸ”¥ Alta prioridade</option>
                                <option value="medium">âš¡ MÃ©dia prioridade</option>
                                <option value="low">ðŸ’§ Baixa prioridade</option>
                            </select>

                            <div className="relative">
                                <Icons.Search />
                                <input
                                    type="text"
                                    placeholder="Buscar hÃ¡bitos..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="pl-8 pr-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-400"
                                />
                            </div>
                        </div>

                        {/* RotaÃ§Ã£o do calendÃ¡rio */}
                        <div className="mb-4">
                            <label className="block text-sm text-gray-300 mb-2">
                                RotaÃ§Ã£o: {rotationAngle}Â°
                            </label>
                            <input
                                type="range"
                                min="-180"
                                max="180"
                                value={rotationAngle}
                                onChange={(e) => setRotationAngle(Number(e.target.value))}
                                className="w-full"
                            />
                        </div>
                    </div>

                    {/* Gerenciador de dados */}
                    {showDataManager && (
                        <div className="bg-gray-800/50 backdrop-blur-xl rounded-3xl p-6 border border-gray-700 shadow-2xl">
                            <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                <Icons.Database />
                                Gerenciamento de Dados
                            </h3>
                            
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <button
                                    onClick={createBackup}
                                    className="flex items-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 rounded-xl text-white transition-colors"
                                >
                                    <Icons.Download />
                                    Criar Backup
                                </button>
                                
                                <label className="flex items-center gap-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl text-white transition-colors cursor-pointer">
                                    <Icons.Upload />
                                    Restaurar Backup
                                    <input
                                        type="file"
                                        accept=".json"
                                        onChange={restoreBackup}
                                        className="hidden"
                                    />
                                </label>
                                
                                <button
                                    onClick={resetAllData}
                                    className="flex items-center gap-2 px-4 py-3 bg-red-600 hover:bg-red-700 rounded-xl text-white transition-colors"
                                >
                                    <Icons.Trash2 />
                                    Reset Completo
                                </button>
                            </div>
                            
                            {resetStatus && (
                                <div className="mt-4 p-3 bg-gray-700 rounded-lg text-center text-white">
                                    {resetStatus}
                                </div>
                            )}
                        </div>
                    )}

                    {/* EstatÃ­sticas */}
                    {showStats && (
                        <div className="bg-gray-800/50 backdrop-blur-xl rounded-3xl p-6 border border-gray-700 shadow-2xl">
                            <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                <Icons.BarChart3 />
                                EstatÃ­sticas do MÃªs
                            </h3>
                            
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div className="text-center">
                                    <div className="text-2xl font-bold text-cyan-400">{stats.totalHabits}</div>
                                    <div className="text-sm text-gray-400">HÃ¡bitos</div>
                                </div>
                                <div className="text-center">
                                    <div className="text-2xl font-bold text-green-400">{stats.totalCompleted}</div>
                                    <div className="text-sm text-gray-400">Completados</div>
                                </div>
                                <div className="text-center">
                                    <div className="text-2xl font-bold text-yellow-400">{stats.totalPossible}</div>
                                    <div className="text-sm text-gray-400">PossÃ­veis</div>
                                </div>
                                <div className="text-center">
                                    <div className="text-2xl font-bold text-purple-400">{stats.completionRate}%</div>
                                    <div className="text-sm text-gray-400">Taxa de ConclusÃ£o</div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* CalendÃ¡rio circular */}
                    <div className="bg-gray-800/50 backdrop-blur-xl rounded-3xl p-6 border border-gray-700 shadow-2xl">
                        <div className="relative flex justify-center">
                            <svg
                                width={svgSize}
                                height={svgSize}
                                className="overflow-visible"
                                style={{ maxWidth: '100%', height: 'auto' }}
                            >
                                {/* Elementos fixos (centro) */}
                                <g>
                                    {fixedElements}
                                </g>
                                
                                {/* Elementos rotativos */}
                                <g transform={`rotate(${rotationAngle} ${svgSize/2} ${svgSize/2})`}>
                                    {rotatingElements}
                                </g>
                            </svg>
                            
                            {/* BotÃ£o central para adicionar hÃ¡bitos */}
                            <button
                                onClick={() => setShowAddForm(true)}
                                className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 mt-8 w-12 h-12 bg-cyan-500 hover:bg-cyan-600 rounded-full flex items-center justify-center text-white shadow-lg transition-all duration-200 hover:scale-110"
                            >
                                <Icons.Plus />
                            </button>
                        </div>
                    </div>

                    {/* Form de adicionar hÃ¡bito */}
                    {showAddForm && (
                        <div className="bg-gray-800/50 backdrop-blur-xl rounded-3xl p-6 border border-gray-700 shadow-2xl">
                            <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                <Icons.Plus />
                                Novo HÃ¡bito
                            </h3>
                            
                            <div className="space-y-4">
                                <input
                                    type="text"
                                    placeholder="Nome do hÃ¡bito..."
                                    value={newHabit}
                                    onChange={(e) => setNewHabit(e.target.value)}
                                    className="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-xl text-white placeholder-gray-400"
                                    maxLength={50}
                                />
                                
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <select
                                        value={selectedPriority}
                                        onChange={(e) => setSelectedPriority(e.target.value)}
                                        className="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"
                                    >
                                        <option value="high">ðŸ”¥ Alta prioridade</option>
                                        <option value="medium">âš¡ MÃ©dia prioridade</option>
                                        <option value="low">ðŸ’§ Baixa prioridade</option>
                                    </select>
                                    
                                    <select
                                        value={selectedDaysType}
                                        onChange={(e) => setSelectedDaysType(e.target.value)}
                                        className="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"
                                    >
                                        <option value="all">Todos os dias</option>
                                        <option value="weekdays">Apenas dias Ãºteis</option>
                                        <option value="weekends">Apenas fins de semana</option>
                                    </select>
                                    
                                    <input
                                        type="time"
                                        value={selectedScheduleTime}
                                        onChange={(e) => setSelectedScheduleTime(e.target.value)}
                                        className="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"
                                        placeholder="HorÃ¡rio (opcional)"
                                    />
                                </div>
                                
                                <div className="flex gap-3">
                                    <button
                                        onClick={addHabit}
                                        disabled={!newHabit.trim()}
                                        className="flex-1 px-4 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-xl text-white transition-colors"
                                    >
                                        Adicionar HÃ¡bito
                                    </button>
                                    <button
                                        onClick={() => setShowAddForm(false)}
                                        className="px-4 py-3 bg-gray-600 hover:bg-gray-700 rounded-xl text-white transition-colors"
                                    >
                                        <Icons.X />
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Lista de hÃ¡bitos */}
                    {filteredHabits.length > 0 && (
                        <div className="bg-gray-800/50 backdrop-blur-xl rounded-3xl p-6 border border-gray-700 shadow-2xl">
                            <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                <Icons.Target />
                                HÃ¡bitos do MÃªs ({filteredHabits.length})
                            </h3>
                            
                            <div className="space-y-3">
                                {filteredHabits.map(habit => {
                                    const { currentStreak, bestStreak } = calculateStreak(habit.id);
                                    const priorityColors = {
                                        high: 'border-red-500 bg-red-500/10',
                                        medium: 'border-orange-500 bg-orange-500/10',
                                        low: 'border-blue-500 bg-blue-500/10'
                                    };
                                    
                                    return (
                                        <div key={habit.id} className={`p-4 rounded-xl border ${priorityColors[habit.priority]}`}>
                                            <div className="flex items-center justify-between">
                                                <div className="flex-1">
                                                    <h4 className="font-semibold text-white">{habit.name}</h4>
                                                    <div className="text-sm text-gray-400 mt-1">
                                                        {habit.priority === 'high' && 'ðŸ”¥ Alta prioridade'}
                                                        {habit.priority === 'medium' && 'âš¡ MÃ©dia prioridade'}
                                                        {habit.priority === 'low' && 'ðŸ’§ Baixa prioridade'}
                                                        {habit.scheduleTime && ` â€¢ ${habit.scheduleTime}`}
                                                    </div>
                                                    {showStreaks && (
                                                        <div className="text-sm text-gray-400 mt-1">
                                                            <Icons.Flame /> {currentStreak} dias â€¢ 
                                                            <Icons.Trophy /> Melhor: {bestStreak} dias
                                                        </div>
                                                    )}
                                                </div>
                                                
                                                <div className="flex items-center gap-2">
                                                    <button
                                                        onClick={() => setExpandedHabitDetails(expandedHabitDetails === habit.id ? null : habit.id)}
                                                        className="p-2 text-gray-400 hover:text-white transition-colors"
                                                    >
                                                        <Icons.Eye />
                                                    </button>
                                                    <button
                                                        onClick={() => deleteHabit(habit.id)}
                                                        className="p-2 text-red-400 hover:text-red-300 transition-colors"
                                                    >
                                                        <Icons.Trash2 />
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}

                    {/* InstruÃ§Ãµes */}
                    <div className="bg-gray-800/50 backdrop-blur-xl rounded-3xl p-6 border border-gray-700 shadow-2xl">
                        <h3 className="text-lg font-bold text-white mb-3 flex items-center gap-2">
                            <Icons.Settings />
                            Como usar
                        </h3>
                        <div className="text-sm text-gray-300 space-y-2">
                            <div className="text-green-400">â€¢ Clique no centro para adicionar novos hÃ¡bitos</div>
                            <div className="text-purple-400">â€¢ Clique nos losangos para marcar dias completados</div>
                            <div className="text-blue-400">â€¢ Use os filtros para organizar seus hÃ¡bitos</div>
                            <div className="text-yellow-400">â€¢ Ajuste a rotaÃ§Ã£o para melhor visualizaÃ§Ã£o</div>
                            <div className="text-cyan-400">â€¢ Seus dados sÃ£o salvos automaticamente</div>
                        </div>
                    </div>
                </div>
            );
        };

        // Renderizar aplicaÃ§Ã£o
        ReactDOM.render(<CircularHabitCalendar />, document.getElementById('root'));
    </script>
</body>
</html>
